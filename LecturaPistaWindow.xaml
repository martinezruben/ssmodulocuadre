<Window x:Class="WPFModuloCuadre.LecturaPistaWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Ingreso Masivo de Lecturas" Height="900" Width="1300"
        WindowStartupLocation="CenterOwner" Background="#F4F6F6">

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border Background="White" BorderBrush="#CFD8DC" BorderThickness="1" CornerRadius="6" Padding="15" Margin="0,0,0,15">
            <TextBlock Text="⛽ INGRESO DE LECTURAS DE PISTA" FontSize="20" FontWeight="Black" Foreground="#37474F" HorizontalAlignment="Center"/>
        </Border>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="0,0,10,0">
            <ItemsControl ItemsSource="{Binding Dispensadores}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border x:Name="CardDisp" Background="White" BorderBrush="#CFD8DC" BorderThickness="1" 
                                CornerRadius="6" Margin="10" Width="580">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Border Background="#ECEFF1" CornerRadius="5,5,0,0" Padding="10" BorderBrush="#CFD8DC" BorderThickness="0,0,0,1">
                                    <TextBlock Text="{Binding Nombre}" FontWeight="Bold" FontSize="14" Foreground="#37474F" HorizontalAlignment="Center"/>
                                </Border>

                                <ItemsControl Grid.Row="1" ItemsSource="{Binding Mangueras}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border BorderBrush="#F5F5F5" BorderThickness="0,0,0,1" Padding="10,8">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="30"/>
                                                        <ColumnDefinition Width="130"/>
                                                        <ColumnDefinition Width="90"/>
                                                        <ColumnDefinition Width="100"/>
                                                        <ColumnDefinition Width="100"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <Border Background="#0288D1" CornerRadius="12" Width="24" Height="24" HorizontalAlignment="Left" VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding Numero}" Foreground="White" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="11"/>
                                                    </Border>

                                                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="5,0,0,0">
                                                        <TextBlock Text="{Binding Producto}" FontSize="12" FontWeight="Bold" Foreground="#455A64" TextWrapping="Wrap"/>
                                                        <TextBlock Text="{Binding Precio, StringFormat='Precio: {0:C}'}" FontSize="10" Foreground="#90A4AE"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="2" VerticalAlignment="Center">
                                                        <TextBlock Text="L. Anterior" FontSize="10" Foreground="#90A4AE"/>
                                                        <TextBlock Text="{Binding LecturaInicial, StringFormat=N2}" FontSize="12" FontWeight="SemiBold" Foreground="#78909C"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="3" VerticalAlignment="Center" Margin="0,0,10,0">
                                                        <TextBlock Text="L. Actual" FontSize="10" Foreground="#0288D1" FontWeight="Bold"/>

                                                        <TextBox Text="{Binding LecturaFinal, UpdateSourceTrigger=PropertyChanged}" 
                                                         FontSize="13" FontWeight="Bold" TextAlignment="Right" Padding="2,4" 
                                                         BorderBrush="#B0BEC5" Background="#FAFAFA"
                                                         GotKeyboardFocus="TextBox_GotKeyboardFocus"
                                                         PreviewKeyDown="TextBox_PreviewKeyDown"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="4" VerticalAlignment="Center" Margin="0,0,10,0">
                                                        <TextBlock Text="{Binding Galones, StringFormat='{}{0:N2} Gls'}" FontSize="11" FontWeight="Bold" Foreground="#E65100" HorizontalAlignment="Right"/>
                                                        <TextBlock Text="{Binding Subtotal, StringFormat=C}" FontSize="13" FontWeight="Black" Foreground="#2E7D32" HorizontalAlignment="Right"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="5" VerticalAlignment="Center">
                                                        <TextBlock Text="Asignar a:" FontSize="10" Foreground="#90A4AE" Margin="0,0,0,2"/>
                                                        <ComboBox ItemsSource="{Binding DataContext.OperadoresView, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                                  SelectedItem="{Binding Operador}" DisplayMemberPath="Nombre" 
                                                                  FontSize="11" Padding="4,2"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <Border Grid.Row="2" Background="#FAFAFA" CornerRadius="0,0,5,5" Padding="10,8">
                                    <DockPanel LastChildFill="False">
                                        <TextBlock Text="{Binding TotalGalones, StringFormat='Total Gls: {0:N2}'}" Foreground="#78909C" FontWeight="Bold" VerticalAlignment="Center" DockPanel.Dock="Left"/>
                                        <TextBlock Text="{Binding TotalDispensador, StringFormat='Total: {0:C}'}" Foreground="#2E7D32" FontWeight="Black" FontSize="14" DockPanel.Dock="Right"/>
                                    </DockPanel>
                                </Border>
                            </Grid>
                        </Border>

                        <DataTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="CardDisp" Property="BorderBrush" Value="#03A9F4"/>
                                <Setter TargetName="CardDisp" Property="BorderThickness" Value="2"/>
                            </Trigger>
                        </DataTemplate.Triggers>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <Button Grid.Row="2" Content="💾 TERMINAR Y APLICAR LECTURAS" Click="BtnCerrar_Click" 
                Height="45" Margin="0,15,0,0" Background="#00C853" Foreground="White" 
                FontWeight="Black" FontSize="14" Cursor="Hand">
            <Button.Resources>
                <Style TargetType="Border">
                    <Setter Property="CornerRadius" Value="4"/>
                </Style>
            </Button.Resources>
        </Button>
    </Grid>
</Window>